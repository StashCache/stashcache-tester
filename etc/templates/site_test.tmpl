#!/bin/sh -x

site=$1
md5check=$2

echo "Running against site $site"

module load stashcp/3.0

testurl={{ testurl }}
actual_file=`basename $testurl`

starttime=`date -u +%s` 
stashcp -d $testurl ./
stashreturn=$?
endtime=`date -u +%s`
echo "starttime=$starttime"
echo "endtime=$endtime"
if [ $stashreturn -ne 0 ]; then
  echo "Error downloading file from $testurl"
  echo "result=unsuccessful"
  exit $stashreturn
fi

sum=`md5sum $actual_file | awk '{print $1;}'`

if [ "$sum" != "$md5check" ]; then
  echo "md5sum doesn't match"
  exit 1
fi

echo "result=successful"

# List the contents of the current directory
ls -l

# Remove the file
rm -rf $actual_file




exit 0
